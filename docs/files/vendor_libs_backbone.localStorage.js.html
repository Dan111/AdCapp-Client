<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>vendor\libs\backbone.localStorage.js - AdCapp</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\..\assets\morgan.jpg" title="AdCapp"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AgendaView.html">AgendaView</a></li>
            
                <li><a href="../classes/AppConfig.html">AppConfig</a></li>
            
                <li><a href="../classes/BasicView.html">BasicView</a></li>
            
                <li><a href="../classes/CalendarView.html">CalendarView</a></li>
            
                <li><a href="../classes/Contact.html">Contact</a></li>
            
                <li><a href="../classes/Contacts.html">Contacts</a></li>
            
                <li><a href="../classes/Event.html">Event</a></li>
            
                <li><a href="../classes/EventCollection.html">EventCollection</a></li>
            
                <li><a href="../classes/EventView.html">EventView</a></li>
            
                <li><a href="../classes/listUser.html">listUser</a></li>
            
                <li><a href="../classes/Main.html">Main</a></li>
            
                <li><a href="../classes/PaperView.html">PaperView</a></li>
            
                <li><a href="../classes/PersonalAgenda.html">PersonalAgenda</a></li>
            
                <li><a href="../classes/ProfileView.html">ProfileView</a></li>
            
                <li><a href="../classes/Router.html">Router</a></li>
            
                <li><a href="../classes/UserCollection.html">UserCollection</a></li>
            
                <li><a href="../classes/UserModel.html">UserModel</a></li>
            
                <li><a href="../classes/UsersListView.html">UsersListView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: vendor\libs\backbone.localStorage.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Backbone localStorage Adapter
 * Version 1.1.0
 *
 * https://github.com/jeromegn/Backbone.localStorage
 */
(function (root, factory) {
   if (typeof define === &quot;function&quot; &amp;&amp; define.amd) {
      // AMD. Register as an anonymous module.
      define([&quot;underscore&quot;,&quot;backbone&quot;], function(_, Backbone) {
        // Use global variables if the locals are undefined.
        return factory(_ || root._, Backbone || root.Backbone);
      });
   } else {
      // RequireJS isn&#x27;t being used. Assume underscore and backbone are loaded in &lt;script&gt; tags
      factory(_, Backbone);
   }
}(this, function(_, Backbone) {
// A simple module to replace &#x60;Backbone.sync&#x60; with *localStorage*-based
// persistence. Models are given GUIDS, and saved into a JSON object. Simple
// as that.

// Hold reference to Underscore.js and Backbone.js in the closure in order
// to make things work even if they are removed from the global namespace

// Generate four random hex digits.
function S4() {
   return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
};

// Generate a pseudo-GUID by concatenating random hexadecimal.
function guid() {
   return (S4()+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+S4()+S4());
};

// Our Store is represented by a single JS object in *localStorage*. Create it
// with a meaningful name, like the name you&#x27;d give a table.
// window.Store is deprectated, use Backbone.LocalStorage instead
Backbone.LocalStorage = window.Store = function(name) {
  this.name = name;
  var store = this.localStorage().getItem(this.name);
  this.records = (store &amp;&amp; store.split(&quot;,&quot;)) || [];
};

_.extend(Backbone.LocalStorage.prototype, {

  // Save the current state of the **Store** to *localStorage*.
  save: function() {
    this.localStorage().setItem(this.name, this.records.join(&quot;,&quot;));
  },

  // Add a model, giving it a (hopefully)-unique GUID, if it doesn&#x27;t already
  // have an id of it&#x27;s own.
  create: function(model) {
    if (!model.id) {
      model.id = guid();
      model.set(model.idAttribute, model.id);
    }
    this.localStorage().setItem(this.name+&quot;-&quot;+model.id, JSON.stringify(model));
    this.records.push(model.id.toString());
    this.save();
    return this.find(model);
  },

  // Update a model by replacing its copy in &#x60;this.data&#x60;.
  update: function(model) {
    this.localStorage().setItem(this.name+&quot;-&quot;+model.id, JSON.stringify(model));
    if (!_.include(this.records, model.id.toString()))
      this.records.push(model.id.toString()); this.save();
    return this.find(model);
  },

  // Retrieve a model from &#x60;this.data&#x60; by id.
  find: function(model) {
    return this.jsonData(this.localStorage().getItem(this.name+&quot;-&quot;+model.id));
  },

  // Return the array of all models currently in storage.
  findAll: function() {
    return _(this.records).chain()
      .map(function(id){
        return this.jsonData(this.localStorage().getItem(this.name+&quot;-&quot;+id));
      }, this)
      .compact()
      .value();
  },

  // Delete a model from &#x60;this.data&#x60;, returning it.
  destroy: function(model) {
    if (model.isNew())
      return false
    this.localStorage().removeItem(this.name+&quot;-&quot;+model.id);
    this.records = _.reject(this.records, function(id){
      return id === model.id.toString();
    });
    this.save();
    return model;
  },

  localStorage: function() {
    return localStorage;
  },

  // fix for &quot;illegal access&quot; error on Android when JSON.parse is passed null
  jsonData: function (data) {
      return data &amp;&amp; JSON.parse(data);
  },

  // Clear localStorage for specific collection.
  _clear: function() {
    var local = this.localStorage(),
      itemRe = new RegExp(&quot;^&quot; + this.name + &quot;-&quot;);

    // Remove id-tracking item (e.g., &quot;foo&quot;).
    local.removeItem(this.name);

    // Match all data items (e.g., &quot;foo-ID&quot;) and remove.
    _.chain(local).keys()
      .filter(function (k) { return itemRe.test(k); })
      .each(function (k) { local.removeItem(k); });
  },

  // Size of localStorage.
  _storageSize: function() {
    return this.localStorage().length;
  }

});

// localSync delegate to the model or collection&#x27;s
// *localStorage* property, which should be an instance of &#x60;Store&#x60;.
// window.Store.sync and Backbone.localSync is deprecated, use Backbone.LocalStorage.sync instead
Backbone.LocalStorage.sync = window.Store.sync = Backbone.localSync = function(method, model, options) {
  var store = model.localStorage || model.collection.localStorage;

  var resp, errorMessage, syncDfd = $.Deferred &amp;&amp; $.Deferred(); //If $ is having Deferred - use it.

  try {

    switch (method) {
      case &quot;read&quot;:
        resp = model.id != undefined ? store.find(model) : store.findAll();
        break;
      case &quot;create&quot;:
        resp = store.create(model);
        break;
      case &quot;update&quot;:
        resp = store.update(model);
        break;
      case &quot;delete&quot;:
        resp = store.destroy(model);
        break;
    }

  } catch(error) {
    if (error.code === DOMException.QUOTA_EXCEEDED_ERR &amp;&amp; store._storageSize() === 0)
      errorMessage = &quot;Private browsing is unsupported&quot;;
    else
      errorMessage = error.message;
  }

  if (resp) {
    model.trigger(&quot;sync&quot;, model, resp, options);
    if (options &amp;&amp; options.success)
      if (Backbone.VERSION === &quot;0.9.10&quot;) {
        options.success(model, resp, options);
      } else {
        options.success(resp);
      }
    if (syncDfd)
      syncDfd.resolve(resp);

  } else {
    errorMessage = errorMessage ? errorMessage
                                : &quot;Record Not Found&quot;;

    model.trigger(&quot;error&quot;, model, errorMessage, options);
    if (options &amp;&amp; options.error)
      if (Backbone.VERSION === &quot;0.9.10&quot;) {
        options.error(model, errorMessage, options);
      } else {
        options.error(errorMessage);
      }

    if (syncDfd)
      syncDfd.reject(errorMessage);
  }

  // add compatibility with $.ajax
  // always execute callback for success and error
  if (options &amp;&amp; options.complete) options.complete(resp);

  return syncDfd &amp;&amp; syncDfd.promise();
};

Backbone.ajaxSync = Backbone.sync;

Backbone.getSyncMethod = function(model) {
  if(model.localStorage || (model.collection &amp;&amp; model.collection.localStorage)) {
    return Backbone.localSync;
  }

  return Backbone.ajaxSync;
};

// Override &#x27;Backbone.sync&#x27; to default to localSync,
// the original &#x27;Backbone.sync&#x27; is still available in &#x27;Backbone.ajaxSync&#x27;
Backbone.sync = function(method, model, options) {
  return Backbone.getSyncMethod(model).apply(this, [method, model, options]);
};

return Backbone.LocalStorage;
}));
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
